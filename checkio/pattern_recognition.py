def checkio(pattern, image):
    pattern_x, pattern_y = len(pattern), len(pattern[0])
    unpacked = sum(pattern, [])
    for k in range(len(image)):
        for i in range(len(image[0])):
            res = list(fetch_sub_mat(k, i, pattern_x, pattern_y))
            try:
                if [image[i][v] for i, v in res] == unpacked:
                    for x, y in res:
                        if image[x][y] == 1:
                            image[x][y] = 3
                        else:
                            image[x][y] = 2
            except IndexError:
                pass
    return image


def fetch_sub_mat(f, s, p_x, p_y):
    for y in range(p_x):
        for k in range(p_y):
            yield (y + f, k + s)


print(checkio([
    [1, 0],
    [1, 1]],

    [[0, 1, 0, 1, 0],
     [0, 1, 1, 0, 0],
     [1, 0, 1, 1, 0],
     [1, 1, 0, 1, 1],
     [0, 1, 1, 0, 0]]))

print(checkio([[1, 1], [1, 1]],
              [[1, 1, 1],
               [1, 1, 1]]))

print(checkio([[0, 1, 0], [1, 1, 1]],
              [[0, 0, 1, 0, 0, 0, 0, 0, 1, 0],
               [0, 1, 1, 1, 0, 0, 0, 1, 1, 1],
               [0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
               [0, 0, 0, 0, 0, 1, 0, 0, 0, 0],
               [0, 1, 0, 0, 1, 1, 1, 0, 1, 0],
               [1, 1, 1, 0, 0, 0, 0, 0, 1, 1],
               [0, 0, 0, 1, 1, 1, 0, 0, 0, 0],
               [0, 0, 1, 0, 0, 0, 0, 1, 0, 0],
               [0, 1, 1, 0, 0, 0, 1, 1, 1, 0],
               [0, 0, 0, 0, 0, 0, 0, 0, 0, 0]]))

print(checkio([[0, 0, 0], [0, 0, 0], [0, 0, 0]],
        [[0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
         [0, 0, 1, 0, 0, 0, 1, 0, 0, 0, 0, 0],
         [0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0],
         [0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0],
         [0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0],
         [0, 0, 1, 0, 0, 0, 0, 0, 1, 0, 0, 0],
         [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
         [0, 1, 0, 0, 0, 0, 1, 0, 0, 0, 1, 0],
         [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
         [0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0],
         [0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0]]))

print( checkio([[1],[1],[1],[1]],[[1,0,1,0,1,0,0,0,1,0,1],
                                  [1,0,1,0,0,0,1,0,1,0,1],
                                  [1,0,0,0,1,0,1,0,1,0,1],
                                  [1,0,1,0,1,0,1,0,0,0,1]]))
